<?xml version="1.0" encoding="UTF-8"?>

<deployment xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="urn:jboss:bean-deployer:2.0">

	<bean name="Mobicents.JAINSLEE.TransactionManagerMBean"
		class="org.mobicents.slee.runtime.transaction.SleeTransactionManagerImpl" autowire-candidate="false">
		<constructor>
          <parameter><inject bean="RealTransactionManager"/></parameter>
     	</constructor>							
	</bean>	
	
	<bean name="Mobicents.JAINSLEE.Cache"
		class="org.mobicents.slee.runtime.cache.MobicentsCache">
		<constructor>
          <parameter><inject bean="MobicentsJBossCache"/></parameter>
          <parameter><inject bean="RealTransactionManager"/></parameter>
     	</constructor>					
	</bean>	
	
	<bean name="Mobicents.JAINSLEE.RmiServerInterfaceMBean"
		class="org.mobicents.slee.container.management.jmx.RmiServerInterfaceMBeanImpl">
		<annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="slee:service=RmiServerInterfaceMBean",exposedInterface=org.mobicents.slee.container.management.jmx.RmiServerInterfaceMBeanImplMBean.class, registerDirectly=true)</annotation>
	</bean>
	
	<bean name="Mobicents.JAINSLEE.AlarmMBean"
		class="org.mobicents.slee.container.management.jmx.AlarmMBeanImpl">
		<annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="javax.slee.management:name=Alarm",exposedInterface=javax.slee.management.AlarmMBean.class, registerDirectly=true)</annotation>
		<demand>Mobicents.JAINSLEE.TransactionManagerMBean</demand>
		<demand>Mobicents.JAINSLEE.SleeManagement</demand>		
	</bean>
    
    <bean name="Mobicents.JAINSLEE.DeploymentMBean"
		class="org.mobicents.slee.container.management.jmx.DeploymentMBeanImpl">
		<annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="javax.slee.management:name=Deployment",exposedInterface=javax.slee.management.DeploymentMBean.class, registerDirectly=true)</annotation>
	</bean>

	<bean name="Mobicents.JAINSLEE.ServiceManagementMBean"
		class="org.mobicents.slee.container.management.jmx.ServiceManagementMBeanImpl">
		<annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="javax.slee.management:name=ServiceManagement",exposedInterface=javax.slee.management.ServiceManagementMBean.class, registerDirectly=true)</annotation>
	</bean>
	
	<bean name="Mobicents.JAINSLEE.TraceMBean"
		class="org.mobicents.slee.container.management.jmx.TraceMBeanImpl">
		<annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="javax.slee.management:name=Trace",exposedInterface=javax.slee.management.TraceMBean.class, registerDirectly=true)</annotation>
		<demand>Mobicents.JAINSLEE.TransactionManagerMBean</demand>
	</bean>
	
	<bean name="Mobicents.JAINSLEE.ProfileProvisoningMBean"
		class="org.mobicents.slee.container.management.jmx.ProfileProvisioningMBeanImpl">
		<annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="javax.slee.management:name=ProfileProvisioning",exposedInterface=javax.slee.management.ProfileProvisioningMBean.class, registerDirectly=true)</annotation>
		<demand>Mobicents.JAINSLEE.TransactionManagerMBean</demand>
		<demand>Mobicents.JAINSLEE.SleeManagement</demand>
	</bean>
	
	<bean name="Mobicents.JAINSLEE.ResourceManagementMBean"
		class="org.mobicents.slee.container.management.jmx.ResourceManagementMBeanImpl">
		<annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="javax.slee.management:name=ResourceManagement",exposedInterface=javax.slee.management.ResourceManagementMBean.class, registerDirectly=true)</annotation>
	</bean>
	
	<bean name="Mobicents.JAINSLEE.SbbEntitiesMBean"
		class="org.mobicents.slee.container.management.jmx.SbbEntitiesMBeanImpl">
		<annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="slee:name=SbbEntitiesMBean",exposedInterface=org.mobicents.slee.container.management.jmx.SbbEntitiesMBeanImplMBean.class, registerDirectly=true)</annotation>
		<demand>Mobicents.JAINSLEE.TransactionManagerMBean</demand>
	</bean>
	
	<bean name="Mobicents.JAINSLEE.SleeManagement"
		class="org.mobicents.slee.container.management.jmx.SleeManagementMBeanImpl">
		<annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="javax.slee.management:name=SleeManagement",exposedInterface=org.mobicents.slee.container.management.jmx.SleeManagementMBeanImplMBean.class, registerDirectly=true)</annotation>
		<property name="sleeTransactionManager"><inject bean="Mobicents.JAINSLEE.TransactionManagerMBean"/></property>
		<property name="mobicentsCache"><inject bean="Mobicents.JAINSLEE.Cache"/></property>
		<property name="alarmMBean">javax.slee.management:name=Alarm</property>
		<property name="deploymentMBean">javax.slee.management:name=Deployment</property>
		<property name="serviceManagementMBean">javax.slee.management:name=ServiceManagement</property>
		<property name="traceMBean">javax.slee.management:name=Trace</property>
		<property name="profileProvisioningMBean">javax.slee.management:name=ProfileProvisioning</property>
		<property name="resourceManagementMBean">javax.slee.management:name=ResourceManagement</property>
		<property name="sbbEntitiesMBean">slee:name=SbbEntitiesMBean</property>
		<property name="rmiServerInterfaceMBean">slee:service=RmiServerInterfaceMBean</property>
		<property name="activityManagementMBean">slee:name=ActivityManagementMBean</property>
		<demand>Mobicents.JAINSLEE.TransactionManagerMBean</demand>
		<demand>Mobicents.JAINSLEE.Cache</demand>
		<demand>Mobicents.JAINSLEE.RmiServerInterfaceMBean</demand>
		<demand>Mobicents.JAINSLEE.MobicentsManagement</demand>						
	</bean>
	
	<bean name="Mobicents.JAINSLEE.ActivityManagementMBean"
		class="org.mobicents.slee.container.management.jmx.ActivityManagementMBeanImpl">
		<annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="slee:name=ActivityManagementMBean",exposedInterface=org.mobicents.slee.container.management.jmx.ActivityManagementMBeanImplMBean.class, registerDirectly=true)</annotation>
		<demand>Mobicents.JAINSLEE.SleeManagement</demand>
	</bean>
	
	<bean name="Mobicents.JAINSLEE.LogManagementMBean"
		class="org.mobicents.slee.container.management.jmx.log.MobicentsLogManagerMBeanImpl">
		<annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="slee:name=LogManagementMBean",exposedInterface=org.mobicents.slee.container.management.jmx.log.MobicentsLogManagerMBeanImplMBean.class, registerDirectly=true)</annotation>
		<demand>Mobicents.JAINSLEE.SleeManagement</demand>
	</bean>
	<bean name="Mobicents.JAINSLEE.PolicyManagementMBean"
		class="org.mobicents.slee.container.management.jmx.PolicyMBeanImpl">
		<annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="slee:name=PolicyManagementMBean",exposedInterface=org.mobicents.slee.container.management.jmx.PolicyMBeanImplMBean.class, registerDirectly=true)</annotation>
		<demand>Mobicents.JAINSLEE.SleeManagement</demand>
		<property name="useMPolicy">true</property>
	</bean>

	<bean name="Mobicents.JAINSLEE.MobicentsManagement"
		class="org.mobicents.slee.container.management.jmx.MobicentsManagement">
		<annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="slee:service=MobicentsManagement",exposedInterface=org.mobicents.slee.container.management.jmx.MobicentsManagementMBean.class, registerDirectly=true)</annotation>
		<property name="entitiesRemovalDelay">1</property>
		<property name="monitoringUncommittedAcAttachs">true</property>
		<property name="eventRouterExecutors">64</property>
    <property name="persistProfiles">true</property>				
	</bean>
	
	<!-- JBOSS CACHE 3 -->
	
	<!-- First we create a Configuration object for the cache -->

   <bean name="MobicentsJBossCacheConfig" class="org.jboss.cache.config.Configuration">  
         
      <property name="runtimeConfig">
         <bean name="MobicentsJBossCacheRuntimeConfig" class="org.jboss.cache.config.RuntimeConfig">
            <property name="transactionManager">
               <inject bean="RealTransactionManager"/>
            </property>
            <!-- <property name="muxChannelFactory"><inject bean="JChannelFactory"/></property> -->
         </bean>
      </property>
      
      <property name="isolationLevel">REPEATABLE_READ</property>
      <property name="cacheMode">LOCAL</property>
      <property name="lockParentForChildInsertRemove">false</property>
      <property name="lockAcquisitionTimeout">15000</property>
      <property name="concurrencyLevel">10000</property>
      
   </bean>

   <!-- Factory to build the Cache. -->
   <bean name="MobicentsJBossCacheFactory" class="org.jboss.cache.DefaultCacheFactory">      
      <constructor factoryClass="org.jboss.cache.DefaultCacheFactory" factoryMethod="getInstance" />
   </bean>  

   <!-- The cache itself -->
   <bean name="MobicentsJBossCache" class="org.jboss.cache.Cache">
      <constructor factoryMethod="createCache">
          <factory bean="MobicentsJBossCacheFactory"/>
          <parameter class="org.jboss.cache.config.Configuration"><inject bean="MobicentsJBossCacheConfig"/></parameter>
          <parameter class="boolean">false</parameter>
      </constructor>
   </bean>

	<bean name="MobicentsJBossCacheJmxWrapper" class="org.jboss.cache.jmx.CacheJmxWrapper">
      <annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.cache:service=MobicentsJBossCache",exposedInterface=org.jboss.cache.jmx.CacheJmxWrapperMBean.class,registerDirectly=true)</annotation>
      <constructor>
          <parameter><inject bean="MobicentsJBossCache"/></parameter>
      </constructor>
   </bean>
   	
</deployment>
